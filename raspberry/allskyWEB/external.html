<html>
    <head>
        <title>Meteollsky SADR</title>
        <!--<link rel="icon" href="images/favicon.ico" />-->
        <link rel="icon" type="image/png" href="images/favicon.png" />
        <meta name="author" content="Sébastien Leclerc" >
        <meta name="date" content="2017-08-15T20:51:00+0200" >
        <meta name="copyright" content="">
        <meta name="keywords" content="">
        <meta name="description" content="">
        <meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8">
        <meta http-equiv="content-style-type" content="text/css">
        <meta http-equiv="expires" content="1">
        <link rel=stylesheet href=css/style.css type=text/css charset=utf-8>
        <script src="js/jquery.min.js"></script>
        <script type=text/javascript src=CHART/meteoconfig.js></script>
        <script type=text/javascript src=js/tween-min.js></script>
        <script type=text/javascript src=js/steelseries-min.js></script>
        <script>
            function init() {
                
                // General variables
                var timeOut=5;// Max timeout update in minutes before sending an alarm
                
                info = new steelseries.DisplaySingle('info', {
                    width: 1200,
                    height: 30,
                    unitStringVisible: false,
                    valuesNumeric: false,
                    autoScroll:true,
                    lcdColor:steelseries.LcdColor.STANDARD
                });
                
                lightLed = new steelseries.Led('daylightFlag', {
                    size:50,
                    ledColor:steelseries.LedColor.RED_LED
                });

                cloudLed = new steelseries.Led('cloudFlag', {
                    size:50,
                    ledColor:steelseries.LedColor.RED_LED
                });

                frezzingLed = new steelseries.Led('frezzingFlag', {
                    size:50,
                    ledColor:steelseries.LedColor.RED_LED
                });

                dewLed = new steelseries.Led('dewFlag', {
                    size:50,
                    ledColor:steelseries.LedColor.RED_LED
                });

                rainLed = new steelseries.Led('rainFlag', {
                    size:50,
                    ledColor:steelseries.LedColor.RED_LED
                });
                windLed = new steelseries.Led('windFlag', {
                    size:50,
                    ledColor:steelseries.LedColor.RED_LED
                });
                
                info.setValue('              WELCOME TO SADR METEOSTATION. LOADING DATA ....');
                info.setScrolling(true);
                
                lightLed.setLedOnOff(false);
                cloudLed.setLedOnOff(false);
                dewLed.setLedOnOff(false);
                frezzingLed.setLedOnOff(false);
                windLed.setLedOnOff(false);
                rainLed.setLedOnOff(false);
                
                update();
                
                function update() {
                    $("#allsky").attr("src", "CHART/allsky.jpg?t=" + new Date().getTime());
                    
                    info.setValue('              WELCOME TO SADR METEOSTATION. LOADING DATA ....');
                    $("#temp").attr("src", "CHART/temp"+$("#range").val()+".png");
                    
                    $.get("CHART/RTdata.json", function(data){
                   		$("#time").text(data.TIME);

                        var warningText='';
                        
                        if (data.daylightFlag==1) {
                        warningText=warningText+"  ****** LUMINOUS ******  ";
                        lightLed.setLedOnOff(true);
                        }
                        
                        if (data.cloudFlag==1) {
                            warningText=warningText+"  ****** CLOUDY ******  ";
                            cloudLed.setLedOnOff(true);
                        }
                        
                        if (data.dewFlag==1) {
                            warningText=warningText+"  ******  DEWING  ******  ";
                            dewLed.setLedOnOff(true);
                        }
                        
                        if (data.frezzingFlag==1) {
                            warningText=warningText+"  ****** FREZZING ******  ";
                            frezzingLed.setLedOnOff(true);
                        }
                        
                        if (data.windFlag==1) {
                            warningText=warningText+"  ****** WINDY ******  ";
                            windLed.setLedOnOff(true);
                        }
                        
                        if (data.rainFlag==1) {
                            warningText=warningText+"  ****** RAINY ******  ";
                            rainLed.setLedOnOff(true);
                        }
                        
                        warningText=warningText+data.TIME;
		                info.setValue(warningText);
                        var dateClient = new Date();
                        dateClient.setHours(dateClient.getHours() + dateClient.getTimezoneOffset()/60); // dateClient in UTC hours
                        var dateRRD = new Date(data.TIME);
                        dateRRD.setHours(dateRRD.getHours() - servertimezone); // dateRRD in UTC hours
                        if (dateClient-dateRRD>timeOut*60000) {
                            info.setValue("WARNING. No updated since: "+data.TIME+" in local time");
                        }
                    }, "json")
               }
			                    		  
               setInterval(function() {update();}, 10000);
            }
        </script>
    </head>
    <body onload=init()>
        <div id=main>
            <div id="left">
            <!-- LED PART -->
                <table>
                    <tr>
                        <td colspan="2">
                            <input type="button" onclick="location.href='index.html';" value="Main" id="button"/>
                         </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input type="button" onclick="location.href='allsky.html';" value="Allsky" id="button" />
                         </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input type="button" onclick="location.href='measures.html';" value="Measures" id="button" />
                         </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input type="button" onclick="location.href='graphs.html';" value="Graphs" id="button" />
                         </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input type="button" onclick="location.href='external.html';" value="Ext. Datas" id="button" />
                         </td>
                    </tr>
                    <tr style="visibility: hidden">
                        <td>
                            <b>Range</b>
                         </td>
                         <td>
                            <select id="range" onchange=update()>
                                <option value=3>3 Hours</option>
                                <option value=24>24 Hours</option>                    
                                <option value=168>1 Week</option>
                                <option value=1176>1 Month</option>
                            </select>
                        </td>
                    </tr>             
                    <tr>
                        <td>
                            <canvas id=frezzingFlag ></canvas>
                        </td>
                        <td>
                            <b>Frezzing</b>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <canvas id=daylightFlag ></canvas>
                        </td>
                        <td>
                            <b>Luminosity</b>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <canvas id=cloudFlag ></canvas>
                        </td>
                        <td>
                            <b>Cloudy</b>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <canvas id=dewFlag ></canvas>
                        </td>
                        <td>
                            <b>Dewing</b>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <canvas id=windFlag ></canvas>
                        </td>
                        <td>
                            <b>Windy</b>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <canvas id=rainFlag ></canvas>
                        </td>
                        <td>
                            <b>Rainy</b>
                        </td>
                    </tr>
                </table>
            </div>
            <div id="right">
                <div id="title">
                    <img src=images/header.png id="banner">
                </div>
                <canvas id=info ></canvas>
                <div id="content">
                    <b>Previsions</b>
                    <p>
                        <img style="width:950px" src="http://clearoutside.com/forecast_image_large/-30.53/-70.80/forecast.png" />
                    </p>
                    <p>
                        <iframe src="https://www.meteoblue.com/en/weather/widget/seeing/-30.53N-70.8E1541_America%2FSantiago?geoloc=fixed&noground=0"  frameborder="0" scrolling="NO" allowtransparency="true" sandbox="allow-same-origin allow-scripts allow-popups" style="width: 520px;height: 754px">
                        </iframe>
                    <iframe src="https://www.meteoblue.com/en/weather/widget/three/-30.53N-70.8E1541_America%2FSantiago?geoloc=fixed&nocurrent=0&nocurrent=1&noforecast=0&days=4&tempunit=CELSIUS&windunit=KILOMETER_PER_HOUR&layout=image"  frameborder="0" scrolling="NO" allowtransparency="true" sandbox="allow-same-origin allow-scripts allow-popups" style="vertical-align:top;width: 460px;height: 512px">
                    </iframe>
                    </p>
                    
                    <b>Sat visuel</b>
                    <!--<p><img class="extImage" src="http://api.sat24.com/animated/FR/visual/3/Romance%20Standard%20Time/9920844" /></p>-->
                    <b>Sat IR</b>
                    <!--<p><img slass="extImage" src="http://api.sat24.com/animated/FR/infraPolair/3/Romance%20Standard%20Time/2790045" /></p>-->
                    <b>Sat Pluie</b>
                    <!--<p><img class="extImage" src="http://api.sat24.com/animated/FR/rainTMC/3/Romance%20Standard%20Time/1169415" /></p>-->
                    <b>Sat IR</b>
                    <!--<p><img class="extImage" src="http://www.meteo60.fr/satellites/animation-satellite-ir-france.gif" /></p>-->
                    <b>Orages</b>
                    <!--<p><img class="extImage" src="http://www.meteo60.fr/foudre/carte_foudre_blitzortung_france_animation.gif" /></p>-->
                    <b>Durée jour/nuit</b>
                    <p><img class="extImage" src="http://clearoutside.com/annual_darkness_image/-30.53/-70.80/annual_darkness.png"></p>
                </div>
            </div>
        </div>
    </body>
</html>
